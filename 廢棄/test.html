<!DOCTYPE html>
<html lang="zh-Hant">

<head>
	<meta charset="UTF-8">
	<title>GitHub 文件展示</title>
	<style>
		div#file-display {
			font-family: Arial, sans-serif;
			margin: 20px;
			padding: 10px;
			background-color: #f0f0f0;
			border: 1px solid #ccc;
		}

		div.file-item {
			margin: 5px;
			padding: 5px;
		}
	</style>
</head>

<body>
	<div id="file-display">正在加載文件列表...</div>
	<script>
		let fileList = [];
		const username = 'soizo';  // 替换为你的GitHub用户名
		const repository = 'soizo.github.io';  // 替换为你的GitHub仓库名
		const branch = '主要';  // GitHub默认分支名改为了'main'
		const path = 'wiki/';  // 根据你的需求设置路径

		async function fetchFiles(url) {
			const response = await fetch(url);
			const data = await response.json();
			if (!Array.isArray(data)) return; // 如果响应不是数组，可能是错误信息，终止处理。

			for (const item of data) {
				fileList.push({
					path: item.path,
					type: item.type // 'file' 或 'dir'
				});
				if (item.type === 'dir') {
					await fetchFiles(`https://api.github.com/repos/${username}/${repository}/contents/${item.path}?ref=${branch}`);
				}
			}

			fileList.sort(customSort);
			displayFiles();
		}

		function customSort(a, b) {
			const depthA = a.path.split('/').length;
			const depthB = b.path.split('/').length;
			if (depthA !== depthB) {
				return depthA - depthB;
			}
			if (a.type !== b.type) {
				return a.type === 'file' ? -1 : 1;
			}
			return a.path.localeCompare(b.path);
		}

		function displayFiles() {
			const container = document.getElementById('file-display');
			container.innerHTML = ''; // 清空现有内容
			fileList.forEach(file => {
				const element = document.createElement('div');
				element.className = 'file-item';
				element.textContent = file.path;
				container.appendChild(element);
			});
		}

		// 启动文件获取函数
		fetchFiles(`https://api.github.com/repos/${username}/${repository}/contents/${path}?ref=${branch}`);
	</script>
</body>

</html>